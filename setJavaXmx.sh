#!/bin/bash

# Get OS amount of memory
RAM_OS=$(cat /proc/meminfo |grep MemTotal: |awk {'print $2'})

# Get Cgroup memory limit
RAM_CGROUP=$(($(cat /sys/fs/cgroup/memory/memory.limit_in_bytes)/1024))

# Check if parameter -Xmx has been specified manualy 
if [ "${JAVA_OPTS}" != "" ]; then
	if [ `echo ${JAVA_OPTS} |grep -c "\-Xmx[0-9]"` -gt 0 ]; then
		exit 0
	fi
fi

# If OS memory is greater then cgroup limit, it means that cgroup memory has been specified
if [ "${RAM_OS}" -gt "${RAM_CGROUP}" ]; then
	echo -n -Xmx$((${RAM_CGROUP}/4*3/1024))m
fi

exit 0
